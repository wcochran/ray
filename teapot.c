#include <stdlib.h>
#include <math.h>
#include "bezier3.h"
#include "bbox.h"
#include "teapot.h"

#define TEA_NUMVERTS 269
#define TEA_NUMPATCHES 28

#define TEA_HEIGHT 3.0  /* height of "stock" teapot */

/*
 * Defined at bottom of file.
 */
extern POINT3 teapotVerts[TEA_NUMVERTS];
extern int teapotIndices[TEA_NUMPATCHES][4][4];

typedef struct {
  BBOX bbox;         /* bounding box */
  int n;             /* number of Bezier patches */
  OBJECT **patches;  /* array of n objects for each patch */
  double color[3];
} TEA_DATA;

static double rayHit(struct OBJECT *this,
		     double rayOrg[3],
		     double rayDir[3],
		     HIT_INFO *info) {
  TEA_DATA *data = (TEA_DATA *) this->data;
  int i, mini;
  double tb[2];
  double mint;
  HIT_INFO min_info;

  if (!rayHitsBoundingBox(&data->bbox, rayOrg, rayDir, tb))
    return -1.0;

  for (i = 0, mint = -1.0; i < data->n; i++) {
    OBJECT *obj = data->patches[i];
    HIT_INFO infoo;
    double t = (*obj->rayHit) (obj, rayOrg, rayDir, &infoo);
    if (t > EPSILON && (mint < 0.0 || t < mint)) {
      mint = t;
      min_info = infoo;
      mini = i;
    }
  }

  if (mint > EPSILON) {
    info->bezier3_mesh.s = min_info.bezier3.s;
    info->bezier3_mesh.t = min_info.bezier3.t;
    info->bezier3_mesh.i = mini;
  }

  return mint;
}

static void normal(struct OBJECT *this,
		   double hitPoint[3],
		   HIT_INFO *info,
		   double normal[3]) {
  TEA_DATA *data = (TEA_DATA *) this->data;
  OBJECT *obj = data->patches[info->bezier3_mesh.i];
  HIT_INFO infoo;
  infoo.bezier3.s = info->bezier3_mesh.s;
  infoo.bezier3.t = info->bezier3_mesh.t;
  (*obj->normal) (obj, hitPoint, &infoo, normal);
}

static void color(struct OBJECT *this,
		  double hitPoint[3],
		  HIT_INFO *info,
		  double color[3]) {
  TEA_DATA *data = (TEA_DATA *) this->data;
  color[0] = data->color[0];
  color[1] = data->color[1];
  color[2] = data->color[2];
}

static void setColor(struct OBJECT *this,
		     double color[3]) {
  TEA_DATA *data = (TEA_DATA *) this->data;
  data->color[0] = color[0];
  data->color[1] = color[1];
  data->color[2] = color[2];
}

OBJECT *createTeapotObject(double bottom[3], 
			   double lidDir[3], double spoutDir[3],
			   double scale) {
  OBJECT *obj;
  TEA_DATA *data;
  double scl;
  double xdir[3], ydir[3], zdir[3];
  double M[3][3];  /* scale/rotate matrix */
  int p;

  if ((obj = (OBJECT *) malloc(sizeof(OBJECT))) == NULL ||
      (data = (TEA_DATA *) malloc(sizeof(TEA_DATA))) == NULL ||
      (data->patches = (OBJECT **) 
       malloc(TEA_NUMPATCHES*sizeof(OBJECT *))) == NULL) {
    perror("createTeapot():malloc()");
    exit(-1);
  }

  scl = 1.0/sqrt(lidDir[0]*lidDir[0] +
		 lidDir[1]*lidDir[1] +
		 lidDir[2]*lidDir[2]);
  ydir[0] = scl*lidDir[0];
  ydir[1] = scl*lidDir[1];
  ydir[2] = scl*lidDir[2];

  zdir[0] = spoutDir[1]*ydir[2] - spoutDir[2]*ydir[1];
  zdir[1] = spoutDir[2]*ydir[0] - spoutDir[0]*ydir[2];
  zdir[2] = spoutDir[0]*ydir[1] - spoutDir[1]*ydir[0];
  scl = 1.0/sqrt(zdir[0]*zdir[0] +
		 zdir[1]*zdir[1] +
		 zdir[2]*zdir[2]);
  zdir[0] *= scl;
  zdir[1] *= scl;
  zdir[2] *= scl;

  xdir[0] = ydir[1]*zdir[2] - ydir[2]*zdir[1];
  xdir[1] = ydir[2]*zdir[0] - ydir[0]*zdir[2];
  xdir[2] = ydir[0]*zdir[1] - ydir[1]*zdir[0];

  scale /= TEA_HEIGHT;   /* adjust so scale = 1 yields unit height */

  M[0][0] = xdir[0]*scale;
  M[0][1] = xdir[1]*scale;
  M[0][2] = xdir[2]*scale;
  
  M[1][0] = ydir[0]*scale;
  M[1][1] = ydir[1]*scale;
  M[1][2] = ydir[2]*scale;

  M[2][0] = zdir[0]*scale;
  M[2][1] = zdir[1]*scale;
  M[2][2] = zdir[2]*scale;

  data->bbox.min.x = data->bbox.min.y = data->bbox.min.z = INFINITY;
  data->bbox.max.x = data->bbox.max.y = data->bbox.max.z = -INFINITY;

  data->n = TEA_NUMPATCHES;

  for (p = 0; p < TEA_NUMPATCHES; p++) {
    int r,c;
    POINT3 P[4][4];

    for (r = 0; r < 4; r++)
      for (c = 0; c < 4; c++) {
	int j;
	POINT3 pt = teapotVerts[teapotIndices[p][r][c]];
	pt.x -= bottom[0];
	pt.y -= bottom[1];
	pt.z -= bottom[2];
	for (j = 0; j < 3; j++) {
	  double x, y, z;
	  x = P[r][c].x = M[0][0]*pt.x + M[0][1]*pt.y + M[0][2]*pt.z;
	  y = P[r][c].y = M[1][0]*pt.x + M[1][1]*pt.y + M[1][2]*pt.z;
	  z = P[r][c].z = M[2][0]*pt.x + M[2][1]*pt.y + M[2][2]*pt.z;

	  if (x < data->bbox.min.x) data->bbox.min.x = x;
	  if (x > data->bbox.max.x) data->bbox.max.x = x;
	  if (y < data->bbox.min.y) data->bbox.min.y = y;
	  if (y > data->bbox.max.y) data->bbox.max.y = y;
	  if (z < data->bbox.min.z) data->bbox.min.z = z;
	  if (z > data->bbox.max.z) data->bbox.max.z = z;
	}
      }

    data->patches[p] = createBezier3Object(P);
  }

  *obj = *data->patches[0];
  obj->data = data;
  obj->rayHit = rayHit;
  obj->normal = normal;
  obj->color = color;
  obj->setColor = setColor;
  
  return obj;
}

POINT3 teapotVerts[TEA_NUMVERTS] = {
  {   1.4000000,    2.2500000,    0.0000000},
  {   1.4000000,    2.2500000,    0.7840000},
  {   0.7840000,    2.2500000,    1.4000000},
  {   0.0000000,    2.2500000,    1.4000000},
  {   1.3375000,    2.3812500,    0.0000000},
  {   1.3375000,    2.3812500,    0.7490000},
  {   0.7490000,    2.3812500,    1.3375000},
  {   0.0000000,    2.3812500,    1.3375000},
  {   1.4375000,    2.3812500,    0.0000000},
  {   1.4375000,    2.3812500,    0.8050000},
  {   0.8050000,    2.3812500,    1.4375000},
  {   0.0000000,    2.3812500,    1.4375000},
  {   1.5000000,    2.2500000,    0.0000000},
  {   1.5000000,    2.2500000,    0.8400000},
  {   0.8400000,    2.2500000,    1.5000000},
  {   0.0000000,    2.2500000,    1.5000000},
  {  -0.7840000,    2.2500000,    1.4000000},
  {  -1.4000000,    2.2500000,    0.7840000},
  {  -1.4000000,    2.2500000,    0.0000000},
  {  -0.7490000,    2.3812500,    1.3375000},
  {  -1.3375000,    2.3812500,    0.7490000},
  {  -1.3375000,    2.3812500,    0.0000000},
  {  -0.8050000,    2.3812500,    1.4375000},
  {  -1.4375000,    2.3812500,    0.8050000},
  {  -1.4375000,    2.3812500,    0.0000000},
  {  -0.8400000,    2.2500000,    1.5000000},
  {  -1.5000000,    2.2500000,    0.8400000},
  {  -1.5000000,    2.2500000,    0.0000000},
  {  -1.4000000,    2.2500000,   -0.7840000},
  {  -0.7840000,    2.2500000,   -1.4000000},
  {   0.0000000,    2.2500000,   -1.4000000},
  {  -1.3375000,    2.3812500,   -0.7490000},
  {  -0.7490000,    2.3812500,   -1.3375000},
  {   0.0000000,    2.3812500,   -1.3375000},
  {  -1.4375000,    2.3812500,   -0.8050000},
  {  -0.8050000,    2.3812500,   -1.4375000},
  {   0.0000000,    2.3812500,   -1.4375000},
  {  -1.5000000,    2.2500000,   -0.8400000},
  {  -0.8400000,    2.2500000,   -1.5000000},
  {   0.0000000,    2.2500000,   -1.5000000},
  {   0.7840000,    2.2500000,   -1.4000000},
  {   1.4000000,    2.2500000,   -0.7840000},
  {   0.7490000,    2.3812500,   -1.3375000},
  {   1.3375000,    2.3812500,   -0.7490000},
  {   0.8050000,    2.3812500,   -1.4375000},
  {   1.4375000,    2.3812500,   -0.8050000},
  {   0.8400000,    2.2500000,   -1.5000000},
  {   1.5000000,    2.2500000,   -0.8400000},
  {   1.7500000,    1.7250000,    0.0000000},
  {   1.7500000,    1.7250000,    0.9800000},
  {   0.9800000,    1.7250000,    1.7500000},
  {   0.0000000,    1.7250000,    1.7500000},
  {   2.0000000,    1.2000000,    0.0000000},
  {   2.0000000,    1.2000000,    1.1200000},
  {   1.1200000,    1.2000000,    2.0000000},
  {   0.0000000,    1.2000000,    2.0000000},
  {   2.0000000,    0.7500000,    0.0000000},
  {   2.0000000,    0.7500000,    1.1200000},
  {   1.1200000,    0.7500000,    2.0000000},
  {   0.0000000,    0.7500000,    2.0000000},
  {  -0.9800000,    1.7250000,    1.7500000},
  {  -1.7500000,    1.7250000,    0.9800000},
  {  -1.7500000,    1.7250000,    0.0000000},
  {  -1.1200000,    1.2000000,    2.0000000},
  {  -2.0000000,    1.2000000,    1.1200000},
  {  -2.0000000,    1.2000000,    0.0000000},
  {  -1.1200000,    0.7500000,    2.0000000},
  {  -2.0000000,    0.7500000,    1.1200000},
  {  -2.0000000,    0.7500000,    0.0000000},
  {  -1.7500000,    1.7250000,   -0.9800000},
  {  -0.9800000,    1.7250000,   -1.7500000},
  {   0.0000000,    1.7250000,   -1.7500000},
  {  -2.0000000,    1.2000000,   -1.1200000},
  {  -1.1200000,    1.2000000,   -2.0000000},
  {   0.0000000,    1.2000000,   -2.0000000},
  {  -2.0000000,    0.7500000,   -1.1200000},
  {  -1.1200000,    0.7500000,   -2.0000000},
  {   0.0000000,    0.7500000,   -2.0000000},
  {   0.9800000,    1.7250000,   -1.7500000},
  {   1.7500000,    1.7250000,   -0.9800000},
  {   1.1200000,    1.2000000,   -2.0000000},
  {   2.0000000,    1.2000000,   -1.1200000},
  {   1.1200000,    0.7500000,   -2.0000000},
  {   2.0000000,    0.7500000,   -1.1200000},
  {   2.0000000,    0.3000000,    0.0000000},
  {   2.0000000,    0.3000000,    1.1200000},
  {   1.1200000,    0.3000000,    2.0000000},
  {   0.0000000,    0.3000000,    2.0000000},
  {   1.5000000,    0.0750000,    0.0000000},
  {   1.5000000,    0.0750000,    0.8400000},
  {   0.8400000,    0.0750000,    1.5000000},
  {   0.0000000,    0.0750000,    1.5000000},
  {   1.5000000,    0.0000000,    0.0000000},
  {   1.5000000,    0.0000000,    0.8400000},
  {   0.8400000,    0.0000000,    1.5000000},
  {   0.0000000,    0.0000000,    1.5000000},
  {  -1.1200000,    0.3000000,    2.0000000},
  {  -2.0000000,    0.3000000,    1.1200000},
  {  -2.0000000,    0.3000000,    0.0000000},
  {  -0.8400000,    0.0750000,    1.5000000},
  {  -1.5000000,    0.0750000,    0.8400000},
  {  -1.5000000,    0.0750000,    0.0000000},
  {  -0.8400000,    0.0000000,    1.5000000},
  {  -1.5000000,    0.0000000,    0.8400000},
  {  -1.5000000,    0.0000000,    0.0000000},
  {  -2.0000000,    0.3000000,   -1.1200000},
  {  -1.1200000,    0.3000000,   -2.0000000},
  {   0.0000000,    0.3000000,   -2.0000000},
  {  -1.5000000,    0.0750000,   -0.8400000},
  {  -0.8400000,    0.0750000,   -1.5000000},
  {   0.0000000,    0.0750000,   -1.5000000},
  {  -1.5000000,    0.0000000,   -0.8400000},
  {  -0.8400000,    0.0000000,   -1.5000000},
  {   0.0000000,    0.0000000,   -1.5000000},
  {   1.1200000,    0.3000000,   -2.0000000},
  {   2.0000000,    0.3000000,   -1.1200000},
  {   0.8400000,    0.0750000,   -1.5000000},
  {   1.5000000,    0.0750000,   -0.8400000},
  {   0.8400000,    0.0000000,   -1.5000000},
  {   1.5000000,    0.0000000,   -0.8400000},
  {  -1.6000000,    1.8750000,    0.0000000},
  {  -1.6000000,    1.8750000,    0.3000000},
  {  -1.5000000,    2.1000000,    0.3000000},
  {  -1.5000000,    2.1000000,    0.0000000},
  {  -2.3000000,    1.8750000,    0.0000000},
  {  -2.3000000,    1.8750000,    0.3000000},
  {  -2.5000000,    2.1000000,    0.3000000},
  {  -2.5000000,    2.1000000,    0.0000000},
  {  -2.7000000,    1.8750000,    0.0000000},
  {  -2.7000000,    1.8750000,    0.3000000},
  {  -3.0000000,    2.1000000,    0.3000000},
  {  -3.0000000,    2.1000000,    0.0000000},
  {  -2.7000000,    1.6500000,    0.0000000},
  {  -2.7000000,    1.6500000,    0.3000000},
  {  -3.0000000,    1.6500000,    0.3000000},
  {  -3.0000000,    1.6500000,    0.0000000},
  {  -1.5000000,    2.1000000,   -0.3000000},
  {  -1.6000000,    1.8750000,   -0.3000000},
  {  -2.5000000,    2.1000000,   -0.3000000},
  {  -2.3000000,    1.8750000,   -0.3000000},
  {  -3.0000000,    2.1000000,   -0.3000000},
  {  -2.7000000,    1.8750000,   -0.3000000},
  {  -3.0000000,    1.6500000,   -0.3000000},
  {  -2.7000000,    1.6500000,   -0.3000000},
  {  -2.7000000,    1.4250000,    0.0000000},
  {  -2.7000000,    1.4250000,    0.3000000},
  {  -3.0000000,    1.2000000,    0.3000000},
  {  -3.0000000,    1.2000000,    0.0000000},
  {  -2.5000000,    0.9750000,    0.0000000},
  {  -2.5000000,    0.9750000,    0.3000000},
  {  -2.6500000,    0.7875000,    0.3000000},
  {  -2.6500000,    0.7875000,    0.0000000},
  {  -2.0000000,    0.7500000,    0.3000000},
  {  -1.9000000,    0.4500000,    0.3000000},
  {  -1.9000000,    0.4500000,    0.0000000},
  {  -3.0000000,    1.2000000,   -0.3000000},
  {  -2.7000000,    1.4250000,   -0.3000000},
  {  -2.6500000,    0.7875000,   -0.3000000},
  {  -2.5000000,    0.9750000,   -0.3000000},
  {  -1.9000000,    0.4500000,   -0.3000000},
  {  -2.0000000,    0.7500000,   -0.3000000},
  {   1.7000000,    1.2750000,    0.0000000},
  {   1.7000000,    1.2750000,    0.6600000},
  {   1.7000000,    0.4500000,    0.6600000},
  {   1.7000000,    0.4500000,    0.0000000},
  {   2.6000000,    1.2750000,    0.0000000},
  {   2.6000000,    1.2750000,    0.6600000},
  {   3.1000000,    0.6750000,    0.6600000},
  {   3.1000000,    0.6750000,    0.0000000},
  {   2.3000000,    1.9500000,    0.0000000},
  {   2.3000000,    1.9500000,    0.2500000},
  {   2.4000000,    1.8750000,    0.2500000},
  {   2.4000000,    1.8750000,    0.0000000},
  {   2.7000000,    2.2500000,    0.0000000},
  {   2.7000000,    2.2500000,    0.2500000},
  {   3.3000000,    2.2500000,    0.2500000},
  {   3.3000000,    2.2500000,    0.0000000},
  {   1.7000000,    0.4500000,   -0.6600000},
  {   1.7000000,    1.2750000,   -0.6600000},
  {   3.1000000,    0.6750000,   -0.6600000},
  {   2.6000000,    1.2750000,   -0.6600000},
  {   2.4000000,    1.8750000,   -0.2500000},
  {   2.3000000,    1.9500000,   -0.2500000},
  {   3.3000000,    2.2500000,   -0.2500000},
  {   2.7000000,    2.2500000,   -0.2500000},
  {   2.8000000,    2.3250000,    0.0000000},
  {   2.8000000,    2.3250000,    0.2500000},
  {   3.5250000,    2.3437500,    0.2500000},
  {   3.5250000,    2.3437500,    0.0000000},
  {   2.9000000,    2.3250000,    0.0000000},
  {   2.9000000,    2.3250000,    0.1500000},
  {   3.4500000,    2.3625000,    0.1500000},
  {   3.4500000,    2.3625000,    0.0000000},
  {   2.8000000,    2.2500000,    0.0000000},
  {   2.8000000,    2.2500000,    0.1500000},
  {   3.2000000,    2.2500000,    0.1500000},
  {   3.2000000,    2.2500000,    0.0000000},
  {   3.5250000,    2.3437500,   -0.2500000},
  {   2.8000000,    2.3250000,   -0.2500000},
  {   3.4500000,    2.3625000,   -0.1500000},
  {   2.9000000,    2.3250000,   -0.1500000},
  {   3.2000000,    2.2500000,   -0.1500000},
  {   2.8000000,    2.2500000,   -0.1500000},
  {   0.0000000,    3.0000000,    0.0000000},
  {   0.0000000,    3.0000000,    0.0020000},
  {   0.0020000,    3.0000000,    0.0000000},
  {   0.8000000,    3.0000000,    0.0000000},
  {   0.8000000,    3.0000000,    0.4500000},
  {   0.4500000,    3.0000000,    0.8000000},
  {   0.0000000,    3.0000000,    0.8000000},
  {   0.0000000,    2.7000000,    0.0000000},
  {   0.2000000,    2.5500000,    0.0000000},
  {   0.2000000,    2.5500000,    0.1120000},
  {   0.1120000,    2.5500000,    0.2000000},
  {   0.0000000,    2.5500000,    0.2000000},
  {  -0.0020000,    3.0000000,    0.0000000},
  {  -0.4500000,    3.0000000,    0.8000000},
  {  -0.8000000,    3.0000000,    0.4500000},
  {  -0.8000000,    3.0000000,    0.0000000},
  {  -0.1120000,    2.5500000,    0.2000000},
  {  -0.2000000,    2.5500000,    0.1120000},
  {  -0.2000000,    2.5500000,    0.0000000},
  {   0.0000000,    3.0000000,   -0.0020000},
  {  -0.8000000,    3.0000000,   -0.4500000},
  {  -0.4500000,    3.0000000,   -0.8000000},
  {   0.0000000,    3.0000000,   -0.8000000},
  {  -0.2000000,    2.5500000,   -0.1120000},
  {  -0.1120000,    2.5500000,   -0.2000000},
  {   0.0000000,    2.5500000,   -0.2000000},
  {   0.4500000,    3.0000000,   -0.8000000},
  {   0.8000000,    3.0000000,   -0.4500000},
  {   0.1120000,    2.5500000,   -0.2000000},
  {   0.2000000,    2.5500000,   -0.1120000},
  {   0.4000000,    2.4000000,    0.0000000},
  {   0.4000000,    2.4000000,    0.2240000},
  {   0.2240000,    2.4000000,    0.4000000},
  {   0.0000000,    2.4000000,    0.4000000},
  {   1.3000000,    2.4000000,    0.0000000},
  {   1.3000000,    2.4000000,    0.7280000},
  {   0.7280000,    2.4000000,    1.3000000},
  {   0.0000000,    2.4000000,    1.3000000},
  {   1.3000000,    2.2500000,    0.0000000},
  {   1.3000000,    2.2500000,    0.7280000},
  {   0.7280000,    2.2500000,    1.3000000},
  {   0.0000000,    2.2500000,    1.3000000},
  {  -0.2240000,    2.4000000,    0.4000000},
  {  -0.4000000,    2.4000000,    0.2240000},
  {  -0.4000000,    2.4000000,    0.0000000},
  {  -0.7280000,    2.4000000,    1.3000000},
  {  -1.3000000,    2.4000000,    0.7280000},
  {  -1.3000000,    2.4000000,    0.0000000},
  {  -0.7280000,    2.2500000,    1.3000000},
  {  -1.3000000,    2.2500000,    0.7280000},
  {  -1.3000000,    2.2500000,    0.0000000},
  {  -0.4000000,    2.4000000,   -0.2240000},
  {  -0.2240000,    2.4000000,   -0.4000000},
  {   0.0000000,    2.4000000,   -0.4000000},
  {  -1.3000000,    2.4000000,   -0.7280000},
  {  -0.7280000,    2.4000000,   -1.3000000},
  {   0.0000000,    2.4000000,   -1.3000000},
  {  -1.3000000,    2.2500000,   -0.7280000},
  {  -0.7280000,    2.2500000,   -1.3000000},
  {   0.0000000,    2.2500000,   -1.3000000},
  {   0.2240000,    2.4000000,   -0.4000000},
  {   0.4000000,    2.4000000,   -0.2240000},
  {   0.7280000,    2.4000000,   -1.3000000},
  {   1.3000000,    2.4000000,   -0.7280000},
  {   0.7280000,    2.2500000,   -1.3000000},
  {   1.3000000,    2.2500000,   -0.7280000},
};

int teapotIndices[TEA_NUMPATCHES][4][4] = {
  {
    {  0,  1,  2,  3},
    {  4,  5,  6,  7},
    {  8,  9, 10, 11},
    { 12, 13, 14, 15},
  },
  {
    {  3, 16, 17, 18},
    {  7, 19, 20, 21},
    { 11, 22, 23, 24},
    { 15, 25, 26, 27},
  },
  {
    { 18, 28, 29, 30},
    { 21, 31, 32, 33},
    { 24, 34, 35, 36},
    { 27, 37, 38, 39},
  },
  {
    { 30, 40, 41,  0},
    { 33, 42, 43,  4},
    { 36, 44, 45,  8},
    { 39, 46, 47, 12},
  },
  {
    { 12, 13, 14, 15},
    { 48, 49, 50, 51},
    { 52, 53, 54, 55},
    { 56, 57, 58, 59},
  },
  {
    { 15, 25, 26, 27},
    { 51, 60, 61, 62},
    { 55, 63, 64, 65},
    { 59, 66, 67, 68},
  },
  {
    { 27, 37, 38, 39},
    { 62, 69, 70, 71},
    { 65, 72, 73, 74},
    { 68, 75, 76, 77},
  },
  {
    { 39, 46, 47, 12},
    { 71, 78, 79, 48},
    { 74, 80, 81, 52},
    { 77, 82, 83, 56},
  },
  {
    { 56, 57, 58, 59},
    { 84, 85, 86, 87},
    { 88, 89, 90, 91},
    { 92, 93, 94, 95},
  },
  {
    { 59, 66, 67, 68},
    { 87, 96, 97, 98},
    { 91, 99,100,101},
    { 95,102,103,104},
  },
  {
    { 68, 75, 76, 77},
    { 98,105,106,107},
    {101,108,109,110},
    {104,111,112,113},
  },
  {
    { 77, 82, 83, 56},
    {107,114,115, 84},
    {110,116,117, 88},
    {113,118,119, 92},
  },
  {
    {120,121,122,123},
    {124,125,126,127},
    {128,129,130,131},
    {132,133,134,135},
  },
  {
    {123,136,137,120},
    {127,138,139,124},
    {131,140,141,128},
    {135,142,143,132},
  },
  {
    {132,133,134,135},
    {144,145,146,147},
    {148,149,150,151},
    { 68,152,153,154},
  },
  {
    {135,142,143,132},
    {147,155,156,144},
    {151,157,158,148},
    {154,159,160, 68},
  },
  {
    {161,162,163,164},
    {165,166,167,168},
    {169,170,171,172},
    {173,174,175,176},
  },
  {
    {164,177,178,161},
    {168,179,180,165},
    {172,181,182,169},
    {176,183,184,173},
  },
  {
    {173,174,175,176},
    {185,186,187,188},
    {189,190,191,192},
    {193,194,195,196},
  },
  {
    {176,183,184,173},
    {188,197,198,185},
    {192,199,200,189},
    {196,201,202,193},
  },
  {
    {203,204,205,203},
    {206,207,208,209},
    {210,210,210,210},
    {211,212,213,214},
  },
  {
    {203,215,204,203},
    {209,216,217,218},
    {210,210,210,210},
    {214,219,220,221},
  },
  {
    {203,222,215,203},
    {218,223,224,225},
    {210,210,210,210},
    {221,226,227,228},
  },
  {
    {203,205,222,203},
    {225,229,230,206},
    {210,210,210,210},
    {228,231,232,211},
  },
  {
    {211,212,213,214},
    {233,234,235,236},
    {237,238,239,240},
    {241,242,243,244},
  },
  {
    {214,219,220,221},
    {236,245,246,247},
    {240,248,249,250},
    {244,251,252,253},
  },
  {
    {221,226,227,228},
    {247,254,255,256},
    {250,257,258,259},
    {253,260,261,262},
  },
  {
    {228,231,232,211},
    {256,263,264,233},
    {259,265,266,237},
    {262,267,268,241},
  },
};
